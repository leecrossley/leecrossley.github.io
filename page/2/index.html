<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Page 2 | iLee | developer blog</title>
  <meta name="author" content="Lee Crossley">
  <meta name="description" content="I write code that sounds awesome and music that&#39;s bug free">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta property="og:site_name" content="iLee"/>
  <meta property="og:image" content="http://www.gravatar.com/avatar/57e15d6acbd5f46c300a83b5e61db1de?s=200"/>
  <link rel="alternate" href="/atom.xml" title="iLee" type="application/atom+xml">
  <link rel="shortcut icon" href="/img/ilee.ico">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-42989646-1', 'ilee.co.uk');
    ga('send', 'pageview');
  </script>

</head>


<body>
  <div id="content" class="inner">
    <header class="logo alignleft">
      <h1>
        <a href="/">iLee</a>
        <span>I write code that sounds awesome and music that&#39;s bug free</span>
      </h1>
    </header>
    <div id="main-col" class="alignright"><div id="wrapper">
  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      <div class="icon"></div>
      
        <time datetime="2013-12-06T10:05:49.000Z" itemprop="datePublished">6th Dec 2013</time>
      
      
  
    <h1 class="title" itemprop="name headline"><a href="/looping-audio-with-phonegap/" itemprop="url">Looping Audio with PhoneGap</a></h1>
  

    </header>
    <div class="entry" itemprop="articleBody">
      
        <h2 id="playing-media-on-repeat">Playing media on repeat</h2>
<p>Playing media is easy with Phonegap / Cordova using the core <a href="http://www.plugreg.com/plugin/apache/cordova-plugin-media" target="_blank">media plugin</a>. I&#39;m using it in the game I&#39;m writing.</p>
<p>The issue is, I wanted to be able to play a background music loop on repeat (don&#39;t worry, the user can switch this off in my apps settings, or simply <a href="/phonegap-plays-sound-on-mute/">mute the sound</a>).</p>
<h3 id="ios">iOS</h3>
<p>There&#39;s an &quot;iOS Quirk&quot; that makes this really easy for iOS devices. From the documentation:</p>
<blockquote>&quot;<strong>numberOfLoops</strong>: Pass this option to the play method to specify the number of times you want the media file to play&quot;</blockquote>

<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="keyword">var</span> myMedia = <span class="keyword">new</span> Media(<span class="string">"/audio/my.mp3"</span>);
myMedia.play({ numberOfLoops: <span class="number">2</span> });
</pre></td></tr></table></figure>

<p>It&#39;s a bit frustrating that you can&#39;t do <code>numberOfLoops: -1</code> to repeat indefinitely, but I can live with it. The issue is, you can&#39;t do this on Android.</p>
<h3 id="android">Android</h3>
<p>Here&#39;s my work around (that I also for iOS too to keep the JavaScript consistent). It&#39;s really frustrating because this could easily be built into the plugin&#39;s native component.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre><span class="keyword">var</span> myMedia;

<span class="keyword">var</span> loop = <span class="function"><span class="keyword">function</span> <span class="params">(status)</span> {</span>
    <span class="keyword">if</span> (status === Media.MEDIA_STOPPED) {
        myMedia.play();
    }
};

myMedia = <span class="keyword">new</span> Media(<span class="string">"/audio/my.mp3"</span>, <span class="literal">null</span>, <span class="literal">null</span>, loop);
myMedia.play();
</pre></td></tr></table></figure>

<p>I&#39;m using the <code>mediaStatus</code> callback that executes when the media status changes, to check to see if the media has stopped playing (it&#39;s finished) and to play the media again.</p>
<p>Can we have a <code>repeat: true</code> please?</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      <div class="icon"></div>
      
        <time datetime="2013-12-03T08:44:40.000Z" itemprop="datePublished">3rd Dec 2013</time>
      
      
  
    <h1 class="title" itemprop="name headline"><a href="/pause-between-grunt-tasks/" itemprop="url">Pause between Grunt Tasks</a></h1>
  

    </header>
    <div class="entry" itemprop="articleBody">
      
        <h2 id="pause-for-debugging">Pause for debugging</h2>
<p>I <a href="/let-grunt-handle-your-tasks/">blogged a while ago</a> about the Grunt JavaScript task runner, a great way to automate your JavaScript tasks.</p>
<p>On complex projects, with numerous multitasks that display output, it occurred to me that you might want to be able to pause the task runner after each task. You may perhaps need to assess the output or check something, then decide whether or not to continue running the remaining tasks.</p>
<h2 id="grunt-pause">grunt-pause</h2>
<p>I&#39;ve implemented a Grunt plugin (in a slightly unorthodox manner) to facilitate the pausing, &quot;<a href="https://npmjs.org/package/grunt-pause" target="_blank">grunt-pause.js</a>&quot;. It uses the hooker to watch for task changes, then fires off a dynamically added task after each change. The <a href="https://npmjs.org/package/inquirer" target="_blank">inquirer</a> node package then kicks in to prompt the developer to either continue (default), or clear the task queue and end the task runner.</p>
<h2 id="grunt-core">Grunt core</h2>
<p>Personally, I think this should be part of the Grunt core. It would be much easier to implement (not hooky hacky), and could be enabled simply with a &quot;--pause&quot; argument on the command line.</p>
<p>If this package gets used, I&#39;ll consider a pull request to Grunt core for version 0.5.0. This package will still be useful for version 0.4.x etc.</p>
<h2 id="usage">Usage</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>npm <span class="keyword">install</span> grunt-pause <span class="comment">## --save-dev</span>
</pre></td></tr></table></figure>


<p>Add the grunt-pause reference to the very top of your Gruntfile.js:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="keyword">var</span> pause = <span class="built_in">require</span>(<span class="string">"grunt-pause"</span>);
</pre></td></tr></table></figure>


<p>Add the pause init call at the top of the module.exports function of your Gruntfile.js::</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>module.exports = <span class="function"><span class="keyword">function</span> <span class="params">(grunt)</span> {</span>
    pause.init(grunt);
</pre></td></tr></table></figure>


<h2 id="sample-output">Sample output</h2>
<p>Sample screenshot of the console output:</p>
<p><img src="https://raw.github.com/leecrossley/grunt-pause/master/grunt-pause.png" alt="Console Screenshot">.</p>
<h2 id="improvements-">Improvements?</h2>
<p>You might not want to have the pause between all tasks, perhaps we could pass an array of exclusions or inclusions when we call <code>pause.init(grunt)</code>?</p>
<p>As always, issues and pull request on the <a href="https://github.com/leecrossley/grunt-pause" target="_blank">git repo</a>.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      <div class="icon"></div>
      
        <time datetime="2013-12-02T11:24:44.000Z" itemprop="datePublished">2nd Dec 2013</time>
      
      
  
    <h1 class="title" itemprop="name headline"><a href="/plugreg-v07-is-now-live/" itemprop="url">PlugReg v0.7 Is Now Live</a></h1>
  

    </header>
    <div class="entry" itemprop="articleBody">
      
        <h2 id="what-s-new">What&#39;s new</h2>
<p>It&#39;s now even easier to find Cordova / PhoneGap plugins on <a href="http://www.plugreg.com" target="_blank">plugreg</a>. To keep up to date with the latest plugreg and plugin related information follow <a href="https://twitter.com/plugreg" target="_blank">@plugreg on twitter</a>.</p>
<h3 id="features">Features</h3>
<p>Here are some of the new features that have been implemented for v0.7:</p>
<ul>
<li><strong>Plugin details</strong>. New design and more info has been added:<ul>
<li>Version number</li>
<li>Last modified</li>
<li>Stars</li>
<li>Issues</li>
</ul>
</li>
<li><strong>Avatars</strong>. Now hotlinks to gravatar or github identicons</li>
<li><strong>Homepage</strong>. A new homepage design, giving various stats, such as:<ul>
<li>Total number of plugins</li>
<li>Total number of authors</li>
<li>Recently Added Plugins (and when they were added)</li>
<li>Recently Updated Plugins (and when they were updated)</li>
<li>Authors with the Most Plugins (and how many plugins each)</li>
<li>Authors with the Most Stars (combined from all their plugins)</li>
<li>Plugins with the Most Stars (and how many stars)</li>
<li>Plugins with the Most Issues (and how many issues)</li>
</ul>
</li>
<li><strong>Search</strong>. Search is now weighted based on plugin stars</li>
<li><strong>Plugin list</strong>. Now contains the number of plugin stars</li>
</ul>
<h3 id="refresh">Refresh</h3>
<p>All plugin details are now updated/refreshed every 30 minutes (this includes issues / stars etc).</p>
<h3 id="api">API</h3>
<p>A basic API is now available listing details of all the indexed plugins - get in touch for more details if you&#39;d like to use it.</p>
<h3 id="bugs">Bugs</h3>
<p>There are also many, many bug fixes.</p>
<h2 id="future-updates">Future updates</h2>
<p>Further updates are on the way shortly. If you&#39;d like to suggest an improvement or report an issue, you can do so on Twitter <a href="https://twitter.com/plugreg" target="_blank">@plugreg</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      <div class="icon"></div>
      
        <time datetime="2013-11-28T09:57:53.000Z" itemprop="datePublished">28th Nov 2013</time>
      
      
  
    <h1 class="title" itemprop="name headline"><a href="/npm-cardiac-arrest/" itemprop="url">npm Cardiac Arrest</a></h1>
  

    </header>
    <div class="entry" itemprop="articleBody">
      
        <h2 id="it-s-happening-again">It&#39;s happening again</h2>
<h3 id="beep-beep-beeeeeeep">Beep, beep, beeeeeeep</h3>
<p>The node package manager &quot;<a href="https://npmjs.org/" target="_blank">npm</a>&quot; is once again grinding to a halt. A <a href="http://blog.nodejs.org/2013/11/26/npm-post-mortem/" target="_blank">post-mortem</a> was published on the official nodejs blog after the recent downtime (November 4th / November 15th 2013), but it&#39;s problems are far from resolved (as demonstrated today).</p>
<p><img src="/img/npm-beat.png" alt="npm Cardiac Arrest"></p>
<h2 id="keep-it-beating-keep-it-awesome">Keep it beating, keep it awesome</h2>
<p>With no other alternative, npm is fundamental to node. More infrastructure is needed to continue to operate the npm registry (multi-master approach and <strong>throw hardware and people at it</strong>).</p>
<p>In my personal opinion (and I know others echo this sentiment) there also needs to be a change to the way npm handles its dependencies. When currently installing a package, half of the registry is downloaded with it. There are ideas, such as materialising a vector of [package, version] -&gt; hash, but this is exceptionally tricky.</p>
<p>The npm registry has served over 150 million requests and 33 million package downloads in the last week. This is 10 times as many requests and downloads as this time last year, with all signs pointing to further exponential growth.</p>
<h2 id="donate">Donate</h2>
<p><strong>I&#39;ve donated</strong> and I also continue to host my personal node projects on nodejitsu. If you&#39;re a developer that&#39;s ever used npm, <a href="https://scalenpm.org/" target="_blank">donate now on the official site</a> and keep npm everything it needs to be for the community.</p>
<p><img src="/img/npm-thanks.png" alt="Thanks"></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      <div class="icon"></div>
      
        <time datetime="2013-11-27T12:57:36.000Z" itemprop="datePublished">27th Nov 2013</time>
      
      
  
    <h1 class="title" itemprop="name headline"><a href="/nesting-ugly-anonymous-functions/" itemprop="url">Nesting Ugly Anonymous Functions</a></h1>
  

    </header>
    <div class="entry" itemprop="articleBody">
      
        <h2 id="we-all-do-it">We all do it</h2>
<p>If you&#39;re a JavaScript developer (or even more likely if you&#39;re a developer that dabbles with JavaScript) you&#39;ll have written code like this many times:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre>document.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="comment">// handler code ...</span>
    alert(<span class="string">"document clicked and fired ugly nested function"</span>);
});
</pre></td></tr></table></figure>

<p>You might be thinking <strong>what&#39;s wrong with that</strong>, but I hope you&#39;re thinking <strong>I&#39;m better than that, I&#39;d do something like this</strong>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="keyword">var</span> doStuff = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="comment">// handler code ...</span>
    alert(<span class="string">"document clicked and fired alert function"</span>);
};

document.addEventListener(<span class="string">"click"</span>, doStuff);
</pre></td></tr></table></figure>

<p><strong>Great</strong>. What do you do if the alert text is dynamic? I&#39;ve seen all kinds of ugly messes that usually lead back to the first approach or result in timing and scoping issues.</p>
<p>This problem isn&#39;t just limited to event handlers, ugly nested anonymous functions are frequently used in callbacks and iterators. This results in poorer performance and <a href="http://youtu.be/bqn7vXeVCLE?t=5s" target="_blank">uglier</a>, less maintainable and bug prone code.</p>
<h2 id="the-right-frame-of-bind-">The right frame of <em>bind</em></h2>
<p>Yes, I really did just make that joke, it&#39;s been a long week. In all seriousness <code>Function.prototype.bind</code> is your friend here, it&#39;ll help you clean up your messy code, like any good friend should. There are other ways to do this of course (JavaScript is wonderful for that):</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="keyword">var</span> doStuff = <span class="function"><span class="keyword">function</span> <span class="params">(message)</span> {</span>
    <span class="comment">// handler code ...</span>
    alert(message);
};

document.addEventListener(<span class="string">"click"</span>, doStuff.bind(<span class="literal">null</span>, <span class="string">"document clicked"</span>));
</pre></td></tr></table></figure>

<p>Clean, reusable and easier to maintain. Better than inlining or manipulating variables at a higher scope.</p>
<h2 id="a-good-curry-">A good <em>curry</em></h2>
<p>You can&#39;t beat a good curry, especially if you find yourself nesting iterator functions (ewww). I suggest you take a look at <a href="https://github.com/leecrossley/functional-js" target="_blank">functional.js</a>, or you can read earlier posts on my blog (<a href="/functional-javascript-library/">first post here</a>).</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      <div class="icon"></div>
      
        <time datetime="2013-11-21T09:21:52.000Z" itemprop="datePublished">21st Nov 2013</time>
      
      
  
    <h1 class="title" itemprop="name headline"><a href="/grouping-consolelog()-output/" itemprop="url">Grouping console.log() Output</a></h1>
  

    </header>
    <div class="entry" itemprop="articleBody">
      
        <h2 id="console-log-">console.log()</h2>
<p>If you&#39;ve ever touched JavaScript in your life, you&#39;ll no doubt know about <code>console.log()</code> for debugging. It allows you to log debug information to the console (on most browsers).</p>
<h2 id="the-problem">The problem</h2>
<p>If you log large amounts of debug information, it is hard to interpret your console output effectively. In fact, you probably make this even worse by wrapping even more debug information around what you&#39;re looking for, to help identify it! e.g.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre>console.log(<span class="string">"MY GROUP"</span>);
console.log(info1);
console.log(info2);
console.log(<span class="string">"MY GROUP END"</span>);
</pre></td></tr></table></figure>

<h2 id="the-solution">The solution</h2>
<h3 id="console-group-">console.group()</h3>
<p>Using <code>console.group()</code> allows you to (go on, guess) group your console output:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>console.group(<span class="string">"My group"</span>);
console.log(info1);
console.log(info2);
</pre></td></tr></table></figure>

<h3 id="console-groupend-">console.groupEnd()</h3>
<p>Using <code>console.groupEnd()</code> allows you to terminate logging to the currently defined console group:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre>console.group(<span class="string">"My group"</span>);
console.log(info1);
console.log(info2);
console.groupEnd();
</pre></td></tr></table></figure>

<h3 id="console-groupcollapsed-">console.groupCollapsed()</h3>
<p>The big hitter, collapse your group by default with <code>console.groupCollapsed()</code> instead of <code>console.group()</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre>console.groupCollapsed(<span class="string">"My group"</span>);
console.log(info1);
console.log(info2);
console.groupEnd();
</pre></td></tr></table></figure>

<h2 id="objects-and-arrays">Objects and arrays</h2>
<h3 id="console-table-">console.table()</h3>
<p>If you&#39;re logging objects and/or arrays in your groups, there&#39;s another winner for you in the form of <code>console.table()</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre>console.groupCollapsed(<span class="string">"My group"</span>);
console.table({
    info1: { message: <span class="string">"message 1"</span> },
    info2: { message: <span class="string">"message 2"</span> }
});
console.groupEnd();
</pre></td></tr></table></figure>

<p><img src="/img/console-output.png" alt="Console Output"></p>
<p>See the <a href="http://jsfiddle.net/Yb7gT/" target="_blank">jsfiddle here</a> - ensure you open the console, then click run.</p>
<p><strong>Happy, <em>clean</em> debugging!</strong></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      <div class="icon"></div>
      
        <time datetime="2013-11-17T20:39:35.000Z" itemprop="datePublished">17th Nov 2013</time>
      
      
  
    <h1 class="title" itemprop="name headline"><a href="/multiple-element-swipe-gesture/" itemprop="url">Multiple Element Swipe Gesture</a></h1>
  

    </header>
    <div class="entry" itemprop="articleBody">
      
        <h2 id="the-swipe-gesture">The swipe gesture</h2>
<p>It&#39;s pretty standard to bind swipe events to elements. For the game I&#39;m currently writing, I needed to do something a little different. I wanted to be able to allow the user to swipe across multiple elements and handle this in an elegant and resource efficient way.</p>
<h2 id="the-solution">The solution</h2>
<p>After testing <em>many solutions</em>, here&#39;s what I came up with (and I think it&#39;s the optimum solution). I&#39;m using <a href="http://zeptojs.com/" target="_blank">zeptojs</a> and it&#39;s touch module, although this solution would work with jquery (if you insist), you&#39;d just need to swap out the <code>e.touches</code> with <code>e.originalEvent.touches</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="keyword">var</span> multiSwipe = <span class="function"><span class="keyword">function</span> <span class="params">(e)</span> {</span>
    <span class="keyword">var</span> touch = e.touches[<span class="number">0</span>],
        element = $(document.elementFromPoint(touch.clientX, touch.clientY));
    <span class="comment">// ...</span>
};

$(<span class="string">".parent"</span>).bind(<span class="string">"touchmove"</span>, multiSwipe);
</pre></td></tr></table></figure>

<p>Essentially, I&#39;m binding the <code>touchmove</code> event to a parent element, then detecting which element is at the current touch point each time the <code>touchmove</code> event is fired. Pretty simple when it&#39;s written for you. </p>
<p>This code is about 10 times smaller than my first attempt and works 10 times faster. <code>document.elementFromPoint</code> is a very effective way to return the topmost element which lies under a given point.</p>
<p>Hammer got it wrong, you <strong>can</strong> touch this.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      <div class="icon"></div>
      
        <time datetime="2013-11-15T07:36:07.000Z" itemprop="datePublished">15th Nov 2013</time>
      
      
  
    <h1 class="title" itemprop="name headline"><a href="/using-game-center-with-phonegap/" itemprop="url">Using Game Center with PhoneGap</a></h1>
  

    </header>
    <div class="entry" itemprop="articleBody">
      
        <h2 id="leaderboards">Leaderboards</h2>
<p>I&#39;ve been writing a game with every spare moment I have (using Cordova / PhoneGap) and really wanted to use the iOS Game Center leaderboard functionality.</p>
<p>Game Center provides a familiar environment for users to compare scores and achievements and challenge friends. Given that most iOS users already have an account and in iOS7 and they&#39;ve improved it <em>quite a bit</em>, it seems silly implementing my own leaderboard server at this stage.</p>
<p>Adding Game Center support requires more than just simple code changes. To create a Game Center aware game, you need to understand <a href="https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/GameKit_Guide/GameCenterOverview/GameCenterOverview.html" target="_blank">these basics</a>.</p>
<p><img src="/img/phonegap-game-center.png" alt="PhoneGap iOS Game Center"></p>
<h2 id="my-game-center-plugin">My Game Center plugin</h2>
<p>A game center plugin didn&#39;t exist for Cordova &gt;= 3.0 or that supported the iOS7 API, so I wrote one, open source.</p>
<h3 id="install-via-the-cli">Install via the CLI</h3>
<p>The below command will install all required code and dependencies (including the GameKit framework), <strong>do not</strong> reference any JavaScript in the HTML, it will be added as part of the cordova platform preparation.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$ cordova plugin add https://github.com/leecrossley/cordova-plugin-game-center.git
</pre></td></tr></table></figure>

<h2 id="basic-usage">Basic usage</h2>
<h3 id="auth">Auth</h3>
<p>It&#39;s recommended that authentication takes place as soon as the deviceready event has been fired (don&#39;t ever attempt to use any plugin code before this, it won&#39;t work). The plugin will then handle the various authentication scenarios (auto-login, signup via a native view controller etc).</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>gamecenter.auth(onSuccess, onError);
</pre></td></tr></table></figure>

<p>If there&#39;s an issue, an error message object is passed back to the <code>onError(message)</code> function.</p>
<p><strong>WARN:</strong> At the time of writing this, rejecting the gamecenter.auth() view controller 3 times in a row (during sign in), will block the app from ever using Game Center on that device. I learned this the hard way and had to reset my phone settings. Sad times.</p>
<h3 id="leaderboard">Leaderboard</h3>
<h4 id="submitting-a-score">Submitting a score</h4>
<p>Ensure the user has been (successfully) authenticated and the leaderboard(s) have been configured in iTunes connect (use the leaderboard identifier assigned there as the leaderboardId).</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="keyword">var</span> scoreData = { 
    score: <span class="number">100</span>, 
    leaderboardId: <span class="string">"YOUR_ID"</span>
};
gamecenter.submitScore(onSuccess, onError, scoreData);
</pre></td></tr></table></figure>

<h4 id="showing-the-native-leaderboard">Showing the native leaderboard</h4>
<p>This is a &quot;quick win&quot; and launches the native Game Center leaderboard view controller for a given period and leaderboard. In other words, there&#39;s no need to do any additional coding or user interface development to display a leaderboard.</p>
<p>The period options are &quot;today&quot;, &quot;week&quot; or &quot;all&quot;.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="keyword">var</span> criteria = { 
    period: <span class="string">"today"</span>,
    leaderboardId: <span class="string">"YOUR_ID"</span>
};
gamecenter.showLeaderboard(onSuccess, onError, criteria);
</pre></td></tr></table></figure>

<p>Note: the <code>onSuccess()</code> (and <code>onError()</code>) are called as the leaderboard is shown, not closed, so you can know if there&#39;s an issue and handle it.</p>
<h3 id="ios-version-support">iOS version support</h3>
<p>I&#39;ve written the plugin to support both iOS 6 and iOS 7 (there are differences in the native implementation, yuck).</p>
<h2 id="source-code">Source code</h2>
<p>The plugin is open source (MIT Licence) and the full source code is available <a href="https://github.com/leecrossley/cordova-plugin-game-center" target="_blank">on github</a>. Please log issues (ideally with pull requests ☺) on there.</p>
<p>The plugin has had a huge uptake already with 11 repo stars within 8 hours of pushing the code!</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      <div class="icon"></div>
      
        <time datetime="2013-11-14T07:56:56.000Z" itemprop="datePublished">14th Nov 2013</time>
      
      
  
    <h1 class="title" itemprop="name headline"><a href="/phonegap-plays-sound-on-mute/" itemprop="url">PhoneGap Plays Sounds on Mute</a></h1>
  

    </header>
    <div class="entry" itemprop="articleBody">
      
        <h2 id="the-cordova-phonegap-media-plugin">The Cordova / PhoneGap media plugin</h2>
<p>As part of my recent game development, there&#39;s a requirement to play short audio sound effects, based on user interaction. There are several options available for doing this but I opted for using a native component using the core Apache <a href="http://www.plugreg.com/plugin/apache/cordova-plugin-media" target="_blank">Media Plugin</a>.</p>
<h2 id="working-in-60-seconds-but-">Working in 60 seconds, but...</h2>
<p>It worked like a treat within seconds of wiring it up, but to my horror, the sound samples were still played when the device (iPhone) was muted by the physical mute button!</p>
<p><strong>What the!?</strong> Not great if you want to play my game on a train.</p>
<p><img src="/img/audio-mute.png" alt="Muted Audio"></p>
<h2 id="-why-why-why-http-youtu-be-9hp44eak8lc-t-44s-"><a href="http://youtu.be/9Hp44eaK8Lc?t=44s" target="_blank">Why Why Why</a></h2>
<p>There are various policies that dictate whether or not a sound is played, interrupted or muted. Cordova / PhoneGap creates an audio session, that was originally designed for apps like Spotify and YouTube that want to play media regardless of the phone state and even if the app isn&#39;t open (screen is locked).</p>
<h2 id="the-solution">The solution</h2>
<p>My initial instinct was to query the state of the mute switch, but I really didn&#39;t want to write a plugin just to do that - I might as well switch to another option for playing the sounds in the actual web view.</p>
<p>After delving into the plugin source I found an option, an option (that is not the default) to make the audio session obey the mute switch. <code>playAudioWhenScreenIsLocked</code>. Yes that&#39;s right, setting playAudioWhenScreenIsLocked will force the plugin to react to the state of the hardware mute button.</p>
<h2 id="full-example">Full example</h2>
<p>Here&#39;s the code you need to play audio that obeys the mute switch:</p>
<h3 id="install-the-media-plugin">Install the media plugin</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$ cordova plugin add https://github.com/apache/cordova-plugin-media.git
</pre></td></tr></table></figure>

<h3 id="in-your-javascript">In your JavaScript</h3>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre><span class="keyword">var</span> playAudio = <span class="function"><span class="keyword">function</span> <span class="params">(file)</span> {</span>
    <span class="keyword">var</span> media = <span class="keyword">new</span> Media(file);
    media.play({ playAudioWhenScreenIsLocked : <span class="literal">false</span> });
};
</pre></td></tr></table></figure>

<p>An incontinent mute, goes without saying.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      <div class="icon"></div>
      
        <time datetime="2013-11-12T09:25:32.000Z" itemprop="datePublished">12th Nov 2013</time>
      
      
  
    <h1 class="title" itemprop="name headline"><a href="/get-adjacent-squares-on-a-grid/" itemprop="url">Get Adjacent Squares on a Grid</a></h1>
  

    </header>
    <div class="entry" itemprop="articleBody">
      
        <h2 id="i-m-writing-a-game-">I&#39;m writing a game!</h2>
<p>That&#39;s right, I&#39;m writing a (<em>puzzle?</em>) game in JavaScript at the moment. I&#39;ve come across a few features that seem difficult to implement but actually have very simple solutions, so I thought I&#39;d share the first one.</p>
<h2 id="a-list-of-adjacent-squares">A list of adjacent squares</h2>
<h3 id="the-grid">The grid</h3>
<p>Let&#39;s say we have a grid of size x by y, the best way to represent this grid is as an array of x and y co-ordinates (starting from the top left first, as that&#39;s how my brain works these days - thank HTML).</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="attr_selector">[1,1]</span> <span class="attr_selector">[2,1]</span> <span class="attr_selector">[3,1]</span> <span class="attr_selector">[4,1]</span> <span class="attr_selector">[5,1]</span> ..
<span class="attr_selector">[1,2]</span> <span class="attr_selector">[2,2]</span> <span class="attr_selector">[3,2]</span> <span class="attr_selector">[4,2]</span> <span class="attr_selector">[5,2]</span> ..
<span class="attr_selector">[1,3]</span> <span class="attr_selector">[2,3]</span> <span class="attr_selector">[3,3]</span> <span class="attr_selector">[4,3]</span> <span class="attr_selector">[5,3]</span> ..
<span class="attr_selector">[1,4]</span> <span class="attr_selector">[2,4]</span> <span class="attr_selector">[3,4]</span> <span class="attr_selector">[4,4]</span> <span class="attr_selector">[5,4]</span> ..
<span class="attr_selector">[1,5]</span> <span class="attr_selector">[2,5]</span> <span class="attr_selector">[3,5]</span> <span class="attr_selector">[4,5]</span> <span class="attr_selector">[5,5]</span> ..
..    ..    ..    ..    ..    ..
</pre></td></tr></table></figure>

<p>This is actually a two dimensional array, which in reality is just an array of arrays. It&#39;s crucial to represent the grid like this, it allows for simpler calculations. Don&#39;t attempt to use a one dimensional array of size x * y, as it&#39;ll just overcomplicate things.</p>
<h3 id="get-adjacent-squares">Get adjacent squares</h3>
<p>Using the above logic, we represent a square as an array containing one x and one y co-ordinate (for example [2,2]). To get a square adjacent to another, it&#39;s pretty simple with this system:</p>
<ul>
<li>Take one from the x co-ordinate [x-1,y]</li>
<li>Add one to the x co-ordinate [x+1,y]</li>
<li>Add one to the y co-ordinate [x,y+1]</li>
<li>Take one from the y co-ordinate [x,y-1]</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="keyword">var</span> adjacents = [[x-<span class="number">1</span>,y],[x+<span class="number">1</span>,y],[x,y+<span class="number">1</span>],[x,y-<span class="number">1</span>]];
</pre></td></tr></table></figure>

<p>There is a maximum possibility of 4 adjacent squares to any other square.</p>
<h3 id="off-the-grid-">Off the grid!</h3>
<p>Squares that are on the edge of the grid might only have 2 or 3 adjacent squares, so we need to check that a possible adjacent is valid:</p>
<ul>
<li>Check the x co-ordinate is greater than or equal to 1, but is also less than or equal to the width of the grid</li>
<li>Check the y co-ordinate is greater than or equal to 1, but is also less than or equal to the height of the grid</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>x &gt;= <span class="number">1</span> && x &lt;= width && y &gt;= <span class="number">1</span> && y &lt;= height
</pre></td></tr></table></figure>

<h2 id="the-solution">The solution</h2>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="code"><pre><span class="keyword">var</span> width = <span class="number">5</span>,
    height = <span class="number">5</span>;

<span class="function"><span class="keyword">function</span> <span class="title">isSquareOnGrid</span><span class="params">(square)</span> {</span>
    <span class="keyword">var</span> x = square[<span class="number">0</span>], 
        y = square[<span class="number">1</span>];
    <span class="keyword">return</span> x &gt;= <span class="number">1</span> && x &lt;= width && y &gt;= <span class="number">1</span> && y &lt;= height;
}

<span class="function"><span class="keyword">function</span> <span class="title">getAdjacents</span><span class="params">(square)</span> {</span>
    <span class="keyword">var</span> x = square[<span class="number">0</span>], 
        y = square[<span class="number">1</span>],
        adjacents = [[x-<span class="number">1</span>,y],[x+<span class="number">1</span>,y],[x,y+<span class="number">1</span>],[x,y-<span class="number">1</span>]];

    <span class="keyword">return</span> adjacents.filter(isSquareOnGrid);
}
</pre></td></tr></table></figure>

<p>I&#39;ve set the height and width of the grid to 5, but they can be anything. To get an array of adjacent squares, you pass the <code>getAdjacents()</code> function a square:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>getAdjacents([<span class="number">2</span>,<span class="number">2</span>]); <span class="comment">// [1,2],[3,2],[2,3],[2,1]</span>
getAdjacents([<span class="number">5</span>,<span class="number">3</span>]); <span class="comment">// [4,3],[5,4],[5,2]</span>
</pre></td></tr></table></figure>

<p>Hopefully you&#39;re also now interested in what on earth I&#39;m writing :)</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





<nav id="pagination">
  
    <a href="/" class="alignleft prev">Prev</a>
  
  
    <a href="/page/3/" class="alignright next">Next</a>
  
  <div class="clearfix"></div>
</nav>
</div></div>
    <div id="sidebar" class="alignleft"><ul class="social">
  <li class="facebook">
    <a href="https://www.facebook.com/lee.crossley" target="_blank" class="icon"><i class="icon-facebook"></i></a>
  </li>
  <li class="twitter">
    <a href="https://twitter.com/lee_crossley" target="_blank" class="icon"><i class="icon-twitter"></i></a>
  </li>
  <li class="github">
    <a href="https://github.com/leecrossley" target="_blank" class="icon"><i class="icon-github"></i></a>
  </li>
  <li class="google-plus">
    <a href="https://plus.google.com/+LeeCrossley?rel=author" target="_blank" class="icon"><i class="icon-google-plus"></i></a>
  </li>
  <li class="linkedin">
    <a href="http://uk.linkedin.com/in/leecrossley/" target="_blank" class="icon"><i class="icon-linkedin"></i></a>
  </li>
</ul>


  <div class="hire-button">
  <a href="/contact-me"><span>Hire Me</span></a>
</div>

  <div class="widget tag">
<ul class="entry">
  
    <li><a href="/">Home</a></li>
  
    <li><a href="/about-me">About Me</a></li>
  
    <li><a href="/contact-me">Contact Me</a></li>
  
    <li><a href="/archives">Archives</a></li>
  
</ul>
</div>

  
<div class="widget tag">
  <h3 class="title">Recent Posts</h3>
  <ul class="entry">
    
      <li>
        <a href="/sat-nav-map-directions-for-phonegap/">Sat Nav Map Directions for PhoneGap</a>
      </li>
    
      <li>
        <a href="/are-you-a-dot-guru/">Are You a Dot Guru?</a>
      </li>
    
      <li>
        <a href="/debugging-wp8-in-phonegap/">Debugging WP8 in PhoneGap</a>
      </li>
    
      <li>
        <a href="/new-features-in-grunt-timer-v03/">New Features in grunt-timer v0.3</a>
      </li>
    
      <li>
        <a href="/ditch-the-www-subdomain/">Ditch the www Subdomain</a>
      </li>
    
      <li>
        <a href="/mobile-ux-to-impact-seo/">Mobile UX to Impact SEO</a>
      </li>
    
      <li>
        <a href="/learn-nodejs-in-2014/">Learn nodejs in 2014</a>
      </li>
    
      <li>
        <a href="/using-npm-in-europe/">Using npm in Europe</a>
      </li>
    
      <li>
        <a href="/list-node-packages-wo-dependencies/">List Node Packages w/o Dependencies</a>
      </li>
    
      <li>
        <a href="/native-page-transitions-with-phonegap/">Native Page Transitions with PhoneGap</a>
      </li>
    
  </ul>
</div>


  

  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/android/">android</a><small>8</small></li>
  
    <li><a href="/tags/app/">app</a><small>9</small></li>
  
    <li><a href="/tags/design/">design</a><small>1</small></li>
  
    <li><a href="/tags/git/">git</a><small>1</small></li>
  
    <li><a href="/tags/hack/">hack</a><small>3</small></li>
  
    <li><a href="/tags/html/">html</a><small>8</small></li>
  
    <li><a href="/tags/iphone/">iphone</a><small>17</small></li>
  
    <li><a href="/tags/javascript/">javascript</a><small>41</small></li>
  
    <li><a href="/tags/phonegap/">phonegap</a><small>15</small></li>
  
    <li><a href="/tags/web/">web</a><small>24</small></li>
  
    <li><a href="/tags/wp8/">wp8</a><small>2</small></li>
  
  </ul>
</div>

</div>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2014 Lee Crossley
  
</div>
<div class="clearfix"></div></footer>
  
<script type="text/javascript">
(function(){
  var dsq = document.createElement("script");
  dsq.type = "text/javascript";
  dsq.async = true;
  dsq.src = "//ilee.disqus.com/count.js";
  (document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(dsq);
}());
</script>

</body>
</html>